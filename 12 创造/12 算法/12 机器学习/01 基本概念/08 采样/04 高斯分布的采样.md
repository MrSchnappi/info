---
title: 04 高斯分布的采样
toc: true
date: 2019-04-09
---
# 高斯分布的采样

高斯分布，又称正态分布，是一个在数学、物理及工程领域都非常重要的概率分布。在实际应用中，经常需要对高斯分布进行采样。

虽然在很多编程语言中，直接调用某个函数就可以生成高斯分布随机数，但了解其中的具体算法能够加深我们对相关概率统计知识的理解。此外，高斯分布的采样方法有多种，通过展示不同的采样方法在高斯分布上的具体操作以及性能对比，我们会对这些采样方法有更直观的印象。

高斯分布，Box-Muller算法，拒绝采样

# 如何对高斯分布进行采样？

<span style="color:red;">说实话，以前从来没有考虑过这关问题。。</span>


首先，假设随机变量 $z$ 服从标准正态分布 $N(0,1)$，令：

$$
x=\sigma \cdot z+\mu\tag{8.7}
$$

则 $x$ 服从均值为 $\mu$、方差为 $\sigma^{2}$ 的高斯分布 $N\left(\mu, \sigma^{2}\right)$ 。

因此，任意高斯分布都可以由标准正态分布通过拉伸和平移得到，所以这里只考虑标准正态分布的采样。

常见的采样方法有逆变换法、拒绝采样、重要性采样、马尔可夫蒙特卡洛采样法等。具体到高斯分布，要如何采样呢？


### 直接用逆变换法

如果直接用逆变换法，基本操作步骤为：

1. 产生 $[0,1]$ 上的均匀分布随机数 $u$ 。
2. 令 $z=\sqrt{2} \operatorname{erf}^{-1}(2 u-1)$ ，则 $z$ 服从标准正态分布。其中 $\operatorname{erf}(\cdot)$ 是高斯误差函数，它是标准正态分布的累积分布函数经过简单平移和拉伸变换后的形式，定义如下：

$$
\operatorname{erf}(x)=\frac{2}{\sqrt{\pi}} \int_{0}^{x} \mathrm{e}^{-t^{2}} \mathrm{d} t\tag{8.8}
$$

### Box–Muller 算法

上述逆变换法需要求解 $\operatorname{erf}(x)$ 的逆函数，这并不是一个初等函数，没有显式解，计算起来比较麻烦，所以为了避免这种非初等函数的求逆操作，Box-Muller 算法提出了如下解决方案：既然单个高斯分布的累计分布函数不好求逆，那么两个独立的高斯分布的联合分布呢？假设 $x$，$y$ 是两个服从标准正态分布的独立随机变量，它们的联合概率密度为：


$$
p(x, y)=\frac{1}{2 \pi} \mathrm{e}^{-\frac{x^{2}+y^{2}}{2}}\tag{8.9}
$$

考虑 $(x, y)$ 在圆盘 $\left\{(x, y) | x^{2}+y^{2} \leqslant R^{2}\right\}$ 上的概率：

$$
F(R)=\int_{x^{2}+y^{2} \leqslant R^{2}} \frac{1}{2 \pi} e^{-\frac{x^{2}+y^{2}}{2}} d x d y\tag{8.10}
$$

通过极坐标变换将 $(x, y)$ 转化为 $(r, \theta)$ ，可以很容易求得二重积分，式（8.10）变为：

$$
F(R)=1-\mathrm{e}^{-\frac{R^{2}}{2}}, R \geqslant 0\tag{8.11}
$$

这里 $F(R)$ 可以看成是极坐标中 $r$ 的累积分布函数。由于 $F(R)$ 的计算公式比较简单，逆函数也很容易求得，所以可以利用逆变换法来对 $r$ 进行采样；对于 $\theta$，在 $[0,2 \pi]$ 上进行均匀采样即可。这样就得到了 $(r, \theta)$，经过坐标变换即可得到符合标准正态分布的 $(x, y)$。具体采样过程如下：

1. 产生 $[0，1]$ 上的两个独立的均匀分布随机数 $u_{1}$，$u_{2}$。
2. 令 $x=\sqrt{-2 \ln \left(u_{1}\right)} \cos 2 \pi u_{2}$
$y=\sqrt{-2 \ln \left(u_{1}\right)} \sin 2 \pi u_{2}$ ，则 $x$，$y$ 服从标准正态分布，并且是相互独立的。

### Marsaglia polar method

Box–Muller 算法由于需要计算三角函数，相对来说还是比较耗时，而 Marsaglia polar method 则避开了三角函数的计算，因而更快，其具体采样操作如下：

1. 在单位圆盘 $\left\{(x, y) | x^{2}+y^{2} \leqslant 1\right\}$ 上产生均匀分布随机数对 $(x, y)$ （在矩形 $\{(x, y) |-1 \leqslant x, y \leqslant 1\}$ 上利用拒绝采样法即可得到）。
2. 令 $s=x^{2}+y^{2}$，则 $x \sqrt{\frac{-2 \ln s}{s}}$，$y \sqrt{\frac{-2 \ln s}{s}}$ 是两个服从标准正态分布的样本，其中 $\frac{x}{\sqrt{s}}$ ，$\frac{y}{\sqrt{s}}$ 用来代替 Box-Muller 算法中的 cosine 和 sine 操作。



### 拒绝采样法

除了逆变换法，我们还可以利用拒绝采样法，选择一个比较好计算累积分布逆函数的参考分布来覆盖当前正态分布（可以乘以一个常数倍），进而转化为对参考分布的采样以及对样本点的拒绝/接收操作。考虑到高斯分布的特性，这里可以用指数分布来作为参考分布。指数分布的累积分布及其逆函数都比较容易求解。由于指数分布的样本空间为 $x \geq 0$ ，而标准正态分布的样本空间为 $(-\infty,+\infty)$，因此还需要利用正态分布的对称性来在半坐标轴和全坐标轴之间转化。具体来说，取 $\lambda=1$ 的指数分布作为参考分布，其密度函数为，

$$
q(x)=e^{-x}\tag{8.12}
$$

对应的累积分布函数及其逆函数分别为：

$$
F(x)=1-e^{-x}\tag{8.13}
$$

$$
F^{-1}(u)=-\log (1-u)\tag{8.14}
$$


利用逆变换法很容易得到指数分布的样本，然后再根据拒绝采样法来决定是否接受该样本，接受的概率为：

$$
A(x)=\frac{p(x)}{M \cdot q(x)}\tag{8.15}
$$

其中 $p(x)=\frac{2}{\sqrt{2 \pi}} \mathrm{e}^{-\frac{x^{2}}{2}}(x \geqslant 0)$ 是标准正态分布压缩到正半轴后的概率密度函数，常数因子 $M$ 需要满足如下条件：


$$
p(x) \leqslant M \cdot q(x), \forall x>0\tag{8.16}
$$


实际应用时，$M$ 需要尽可能小，这样每次的接受概率大，采样效率更高。因此，可以取：

$$
M=\sup _{x \geqslant 0} \frac{p(x)}{q(x)}\tag{8.17}
$$

计算后得到接受概率：

$$
A(x)=e^{-\frac{(x-1)^{2}}{2}}\tag{8.18}
$$

因此，具体的采样过程如下：

1. 产生 $[0，1]$ 上的均匀分布随机数 $u_{0}$，计算 $x=F^{-1}\left(u_{0}\right)$ 得到指数分布的样本 $x$。
2. 再产生 $[0，1]$ 上的均匀分布随机数 $u_{1}$，若 $u_{1}<A(x)$，则接受 $x$，进入下一步；否则拒绝，跳回到步骤 1 重新采样。
3. 最后再产生 $[0，1]$ 上的均匀分布随机数 $u_{2}$ ，若 $u_{2}<0.5$ ，则将 $x$ 转化为 $−x$，否则保持不变；由此最终得到标准正态分布的一个样本。


### Ziggurat 算法

拒绝采样法的效率取决于接受概率的大小：参考分布与目标分布越接近，则采样效率越高。有没有更高效的拒绝采样算法呢？

这就是 Ziggurat 算法，该算法本质也是拒绝采样，但采用多个阶梯矩形来逼近目标分布（见图 8.5）。Ziggurat算法虽然看起来稍微烦琐，但实现起来并不复杂，操作也非常高效，感兴趣的读者可以自行查阅相关文献。

Ziggurat算法示意图：

![](http://images.iterate.site/blog/image/20190409/RwRqpFz7WO9l.png?imageslim){ width=55% }



## 总结与扩展

高斯分布的采样方法还有很多，我们只列举了几种最常见的。具体面试时，面试者不需要回答所有的方法，知道其中一两种即可，面试官可能会针对这一两种方法深入提问，如理论证明、优缺点、性能等。面试时如果没有思路，可以回忆那些通用的采样方法，如何将那些策略用到高斯分布这个具体案例上。

另外，本题还可以适当扩展，例如：

- 多维高斯分布随机向量如何采样？
- 截尾高斯分布（Truncated Gaussian Distribution）如何采样？

<span style="color:red;">上面这两个是啥？</span>

## 逸闻趣事 正态分布为何又称高斯分布

正态分布最早出现在 1738 年棣莫弗（Abraham de Moivre）著作的书籍 《The Doctrine of Chances》中：当二项分布的参数 $n$ 很大且参数 $p$ 为 $1/2$ 时，对应的近似分布函数就是正态分布（当时还没有被命名为正态分布）。后来，拉普拉斯（Pierre-Simon marquis de Laplace）将二项分布的正态近似这个结论扩展到任意参数 $0<p<1$ ，即现在的棣莫弗-拉普拉斯定理。

棣莫弗在二项分布的计算中瞥见了正态分布的模样，不过他并没有展现这个分布的美妙之处。棣莫弗不是统计学家，未从统计学角度考虑这个工作的意义，所以这个发现当时并没有引起人们足够的重视，正态分布当时也只是以极限分布的形式出现，并没有在统计学，尤其是误差分析中发挥作用。这也是正态分布最终没有被冠名棣莫弗分布的重要原因。


后来，拉普拉斯在误差分析试验中使用了正态分布。勒让德（Adrien-Marie Legendre）于 1805 年引入最小二乘法这一重要方法，而高斯（Johann Carl Friedrich Gauss）则宣称他早在 1794 年就使用了该方法，并通过假设误差服从正态分布给出了严格的证明。

高斯的介入首先要从天文学界的一个事件说起。1801年 1 月，天文学家朱塞普·皮亚齐（Giuseppe Piazzi）发现了一颗从未见过的光度 8 等的星在移动，这颗现在被称作谷神星（Ceres）的小行星在夜空中出现 6 个星期，扫过八度角后就在太阳的光芒下没了踪影，无法观测。留下的观测数据有限，天文学家难以计算出它的轨道，因此也无法确定这颗新星是彗星还是行星，这个问题很快成了学术界关注的焦点。高斯当时已经是很有名望的年轻数学家了，这个问题也引起了他的兴趣。他以卓越的数学才能创立了一套全新的行星轨道计算方法，很快就计算出了谷神星的轨道，并预言了它在夜空中出现的时间和位置。1801年 12 月 31 日夜，德国天文爱好者奥伯斯（Heinrich Olbers）在高斯预言的时间里，用望远镜对准了这片天空。果然不出所料，谷神星出现了！高斯为此名声大震，但是他当时拒绝透露计算轨道的方法。原因可能是，高斯认为自己的方法的理论基础还不够成熟，而他一向治学严谨、精益求精，不轻易发表没有思考成熟的理论。直到 1809 年，高斯系统地完善了相关的数学理论后，才将他的方法公布于众，而其中使用的数据分析方法，就是以正态误差分布为基础的最小二乘法。勒让德和高斯关于最小二乘法的发明权之争，成了数学史上仅次于牛顿、莱布尼茨微积分发明权的争端。<span style="color:red;">厉害呀。</span>

在整个正态分布被发现与应用的历史中，棣莫弗、拉普拉斯、高斯各有贡献：拉普拉斯从中心极限定理的角度解释它，高斯把它应用在误差分析中，殊途同归。正态分布被发现有这么好的性质，各国人民都争抢它的冠名权。因为拉普拉斯是法国人，所以当时在法国被称为拉普拉斯分布；而高斯是德国人，所以在德国叫作高斯分布；第三中立国的人民称它为拉普拉斯-高斯分布。后来法国大数学家庞加莱（Jules Henri Poincaré）建议改用正态分布这一中立名称，随后统计学家卡尔·皮尔森（Karl Pearson）使得这个名称被广泛接受（但是正态分布这个名字似乎会给人一种谬误，即其他很多概率分布都是不正态的）。

不过因为高斯在数学界的名气实在是太大，正态分布的桂冠还是更多地被戴在了高斯头上，目前数学界是正态分布和高斯分布两者并用。有趣的是，“高斯分布”也正好是“Stigler名字由来法则”的一个例证，这个法则说的是“没有科学发现是以它最初的发现者命名的”。


# 相关

- 《百面机器学习》
