
# 进程和线程

进程和线程：

- 线程是最小的执行单元，而进程由至少一个线程组成。
- 如何调度进程和线程，完全由操作系统决定，程序自己不能决定什么时候执行，执行多长时间。
- 有时，同时执行的多个任务之间需要相互通信和协调，涉及到同步、数据共享的问题。
- 真正的并行执行多任务只能在多核 CPU 上实现


## 一些概念


对于多任务的处理：

- 要实现多任务，通常我们会设计 Master-Worker模式，Master负责分配任务，Worker负责执行任务，因此，多任务环境下，通常是一个 Master，多个 Worker。
- 多任务一旦多到一个限度，就会消耗掉系统所有的资源，结果效率急剧下降，所有任务都做不好。
- 如果是计算密集型任务，那么同时进行的数量应当等于 CPU 的核心数，尽量使用 c 实现。如果是IO 密集型任务，那么 99%的时间都花在 IO 上，花在 CPU 上的时间很少，脚本语言是首选。


多进程：

- 优点：稳定性高，因为一个子进程崩溃了，不会影响主进程和其他子进程。
- 缺点：创建进程的代价大，在 Unix/Linux系统下，用`fork`调用还行，在 Windows 下创建进程开销巨大。另外，操作系统能同时运行的进程数也是有限的，在内存和 CPU 的限制下，如果有几千个进程同时运行，操作系统连调度都会成问题。

多线程：

- 优点：通常比多进程快一点，但是也快不到哪去
- 缺点：任何一个线程挂掉都可能直接造成整个进程崩溃，因为所有线程共享进程的内存。在 Windows 上，如果一个线程执行的代码出了问题，你经常可以看到这样的提示：“该程序执行了非法操作，即将关闭”，其实往往是某个线程出了问题，但是操作系统会强制结束整个进程。


协程：

- Python 中，单线程的异步编程模型称为协程，有了协程的支持，就可以基于事件驱动编写高效的多任务程序。


