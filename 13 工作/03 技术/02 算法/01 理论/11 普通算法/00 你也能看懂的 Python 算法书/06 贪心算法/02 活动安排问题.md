---
title: 02 活动安排问题
toc: true
date: 2019-07-01
---
# 活动安排问题

活动安排问题是解决需要共享公共资源的一系列活动的高效安排问题，以在限定的资源前提下尽可能多地安排活动。

## 问题描述

有若干个活动，第 i 个活动的开始时间和结束时间是[Si,fi)，只有一间教室，活动之间不能交叠，求最多能安排多少个活动？

分析：目的是提高教室的利用率，尽可能多地安排活动。

考虑容易想到的几种贪心策略。

开始最早的活动优先，目的是想尽早结束活动，让出教室。然而，这个显然不行，因为最早的活动可能时间很长，影响后面的活动。例如，活动开始和结束时间分别为[0,100)、[1,2)、[2,3)、[3,4)、[4,5]，安排［0,100)这个活动之后，无法安排其他活动，最优解是安排除它之外的 4 个活动。

短活动优先，目的也是尽量空出教室。但是不难构造如下反例：[0,5)、[5,10)、[3,7)，这里[3,7)最短，但如果安排了[3,7)，其他两个无法安排了。最优解显然是安排其他两个，而放弃[3,7)，可见这个贪心策略也是不行的。

最少冲突的活动优先，既然上面说安排活动是想减少冲突，那么如果优先安排冲突最少的活动呢？至少从前两个例子来看，这个策略是有效的。真是对的吗？尝试一下下面这个例子：

[0,2)[2,4)[4,6)[6,8)

[1,3)[1,3)[1,3)[3,5)[5,7)[5,7)[5,7)

[0,2)和 3 个活动冲突—3个[1,3),[2,4)和 4 个活动冲突—3个[1,3)和一个[3,5),[4,6)和也和 4 个活动冲突—3个[5,7)和一个[3,5),[6,8)和 3 个活动冲突—3个[5,7)。

下面的[1,3)和[5,7)每个都和 5 个活动冲突，而[3,5)只和两个活动冲突—[2,4)和[4,6)。

按照我们的策略应该先安排[3,5)，可是一旦选择了[3,5)，最多只可能安排 3 个活动。

但明显第一行的 4 个活动都可以安排下来，所以这种策略也是不对的。

看似最不对的策略—结束时间越早的活动优先，反而是有效的。可以这样证明，假设最优解 OPT 中安排了 m 个活动，我们把这些活动按照结束时间由小到大排序，显然是不冲突的。假设排好顺序后，这些活动是 a(1)、a(2)、a(3)、...、a(m)。

按照我们的贪心策略，选出的活动自然是按照结束时间排好顺序的，并且也都是不冲突的，这些活动是 b(1)、b(2)、...、b(n)。

关键问题是，假设 a(1)=b(1)、a(2)=b(2)、...、a(k)=b(k)，但是 a(k+1)!=b(k+1)，回答以下几个问题：

b(k+1)会在 a(k+2)、a(k+3)、...、a(m)中出现吗？

不会。因为 b(k+1)的结束时间是最早的，即 f(b(k+1))<=f(a(k+1))，而 a(k+2)、a(k+3)、…、a(m)的开始时间和结束时间都在 f(a(k+1))之后，所以 b(k+1)不在其中。

b(k+1)和 a(1)、a(2)、...、a(k)冲突吗？

不冲突，因为 a(1)、a(2)、...、a(k)就是 b(1)、b(2)、…、b(k)。

b(k+1)和 a(k+2)、a(k+3)、...、a(m)冲突吗？

不冲突，因为 f(b(k+1))<=f(a(k+1))，而 a(k+2)、a(k+3)、...、a(m)的开始时间都在 f(a(k+1))之后，更在 f(b(k+1))之后。

因此可以把 a(k+1)换成 b(k+1)，从而最优解和贪心得到的解多了一个相同的，经过一个一个替换，可以把最优解完全替换成贪心策略得到的解，从而证明了这个贪心策略的最优性。

## 最终代码

通过比较下一个活动的开始时间与上一个活动的结束时间的大小关系，确定这两个活动是否是相容的，如果开始时间大于结束时间，则相容，反之不相容，程序如代码 7.2所示。

代码 7.2 活动安排问题的贪心算法求解
