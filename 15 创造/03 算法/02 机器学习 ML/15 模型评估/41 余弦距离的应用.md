---
title: 41 余弦距离的应用
toc: true
date: 2019-03-27
---
# 可以补充进来的

- 这个余弦距离还是要与距离这些放在一起比较好



# 余弦距离的应用


本章的主题是模型评估，但其实在模型训练过程中，我们也在不断地评估着样本间的距离，如何评估样本距离也是定义优化目标和训练方法的基础。<span style="color:red;">嗯，关于这个样本间的距离还是要单独拿出来总结下的。</span>

在机器学习问题中，通常将特征表示为向量的形式，所以在分析两个特征向量之间的相似性时，常使用余弦相似度来表示。余弦相似度的取值范围是`[−1，1]`，相同的两个向量之间的相似度为 1。如果希望得到类似于距离的表示，将 1 减去余弦相似度即为余弦距离。因此，余弦距离的取值范围为 `[0，2]`，相同的两个向量余弦距离为 0。



## 余弦距离是否是一个严格定义的距离?


该题主要考察面试者对距离的定义的理解，以及简单的反证和推导。

首先看距离的定义：在一个集合中，如果每一对元素均可唯一确定一个实数，使得三条距离公理（正定性，对称性，三角不等式）成立，则该实数可称为这对元素之间的距离。<span style="color:red;">确认下什么是正定性，之前看过但是又不是很清楚了。</span>


余弦距离满足正定性和对称性，但是不满足三角不等式，因此它并不是严格定义的距离。<span style="color:red;">嗯。</span>

具体来说，对于向量 A 和 B，三条距离公理的证明过程如下。


**正定性**


根据余弦距离的定义，有：

$$dist(A,B)=1-cos\theta =\frac{||A||_2||B||_2-AB}{||A||_2||B||_2}$$

考虑到 $||A||_2||B||_2-AB\geq 0$，因此有 $dist(A,B)$ 恒成立。特别地，有：

$$dist(A,B)=0\Leftrightarrow ||A||_2||B||_2=AB\Leftrightarrow A=B$$

因此余弦距离满足正定性。

**对称性**

根据余弦距离的定义，有


$$dist(A,B)=\frac{||A||_2||B||_2-AB}{||A||_2||B||_2}=\frac{||B||_2||A||_2-AB}{||B||_2||A||_2} =dist(B,A)$$

因此余弦距离满足对称性。

**三角不等式**


该性质并不成立，下面给出一个反例。给定 A=（1，0），B=（1，1），C=（0，1），则有：

$$dist(A,B)=1-\frac{\sqrt{2}}{2}$$
$$dist(B,C)=1-\frac{\sqrt{2}}{2}$$
$$dist(A,C)=1$$

因此有

$$ dist(A,B)+dist(B,C)=2-\sqrt{2}< 1=dist(A,C)$$

假如面试时候紧张，一时想不到反例，该怎么办呢？此时可以思考余弦距离和欧氏距离的关系。从问题 1 中，我们知道单位圆上欧氏距离和余弦距离满足：

$$||A-B||=\sqrt{2(1-cos(A,B))}=\sqrt{2dist(A,B)}$$

即有如下关系：

$$dist(A,B)=\frac{1}{2}||A-B||^2$$

显然在单位圆上，余弦距离和欧氏距离的范围都是`[0，2]`。我们已知欧氏距离是一个合法的距离，而余弦距离与欧氏距离有二次关系，自然不满足三角不等式。

具体来说，可以假设 A 与 B、B与 C 非常近，其欧氏距离为极小量 u；此时 A、B、C虽然在圆弧上，但近似在一条直线上，所以 A 与 C 的欧氏距离接近于 2u。因此，A与 B、B与 C 的余弦距离为 $u^2/2$ ；A与 C 的余弦距离接近于 $2u^2$，大于 A 与 B、B与 C 的余弦距离之和。<span style="color:red;">嗯，是的。</span>


面试者在碰到这类基础证明类的问题时，往往会遇到一些困难。比如对面试官考察的重点“距离”的定义就不一定清晰地记得。这个时候，就需要跟面试官多沟通，在距离的定义上达成一致（要知道，面试考察的不仅是知识的掌握程度，还有面试者沟通和分析问题的能力 <span style="color:red;">是的。</span>）。要想给出一个完美的解答，就需要清晰的逻辑、严谨的思维。比如在正定性和对称性的证明过程中，只是给出含糊的表述诸如“显然满足”是不好的，应该给出一些推导。最后，三角不等式的证明/证伪中，不应表述为“我觉得满足/不满足”，而是应该积极分析给定三个点时的三角关系，或者推导其和欧氏距离的关系，这样哪怕一时找不到反例而误认为其是合法距离，也比“觉得不满足”这样蒙对正确答案要好。


笔者首次注意到余弦距离不符合三角不等式是在研究电视剧的标签时，发现在通过影视语料库训练出的词向量中，comedy 和 funny、funny 和 happy的余弦距离都很近，小于 0.3，然而 comedy 和 happy 的余弦距离却高达 0.7。这一现象明显不符合距离的定义，引起了我们的注意和讨论，经过思考和推导，得出了上述结论。<span style="color:red;">嗯。</span>


在机器学习领域，被俗称为距离，却不满足三条距离公理的不仅仅有余弦距离，还有 KL 距离（Kullback-Leibler Divergence），也叫作相对熵，它常用于计算两个分布之间的差异，但不满足对称性和三角不等式。<span style="color:red;">这个 KL 距离还是要补充下的。是 KL 散度吗？</span>









# 相关

- 《百面机器学习》
