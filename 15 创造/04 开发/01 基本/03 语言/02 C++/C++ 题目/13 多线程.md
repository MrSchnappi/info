---
title: 13 多线程
toc: true
date: 2018-08-28
---

#### Q 21 :

题目：

i的初始值为 0，i++在两个线程里面分别执行 100 次，能得到最大值是()，最小值是()。

答案:

200
2

<span style="color:red;">为什么最小值是 2？</span>

解答:

考察多线程操作同一未上锁变量。

1. 每次都准确加 1，结果为最大，200。
2. 结果为 2 时步骤：
    a取内存 0 到寄存器，b取内存 0 到寄存器；
    a执行 99 次并写入内存，内存值为 99；
    b执行 1 次并写入内存，内存值被覆盖为 1；
    a取内存 1 到寄存器，b取内存 1 到寄存器；
    b执行 99 次并写入内存，内存值为 100；
    a执行 1 次，写入内存，覆盖之前的 100，值为 2。 <span style="color:red;">嗯，这个之前不知道。</span>
3. 每次计算过程必须是先从内存取数然后计算，之后再重新写入内存。但对各个线程而言，取数和计算中间可以被另一个线程打断。






#### Q 65 :

题目：

假设下面的函数 foo 会被多线程调用，那么让 i、j、k三个变量哪些因为线程间共享访问需要加锁保护:

```
int i = 0;
void foo(){
    static int j = 0;
    int k = 0;
    i++;
    j++;
    k++;
}
```

答案：
i和 j

解答：
考察多线程情况下数据加锁问题。
1. 多线程调用时要进行保护时，主要是针对全局变量和静态变量（无论局部或全局）的，函数内的局部变量不会受到影响。
2. i是全局变量，j是静态局部变量。






#### Q 69 :

题目：
两个等价线程并发的执行下列程序，a为全局变量，初始为 0，假设 printf、++、--操作都是原子性的，则输出肯定不是哪个：

答案：
0
1

解答：
考察多线程并发结果。
