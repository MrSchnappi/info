---
title: 03 可视化
toc: true
date: 2019-07-02
---
4.3 可视化
虽然有多个可视化软件包，但是在这一节中，我们将专门使用 matplotlib 和 Bokeh，用最好的用具来满足你的需求。
这两个包都预先安装到了 Anaconda 中。首先让我们加载模块并设置这两个包：
％matplotlib inline和 output_notebook（）命令分别会使用 matplotlib 或者 Boken 生成每个图表，并且出现在笔记本而不是一个单独的窗口中。
4.3.1 直方图
直方图是迄今为止最容易直观地计算显示特征分布的方法。PySpark中（或者 Jupyter notebook）有三种方法可以生成直方图：
·聚集工作节点中的数据并返回一个汇总 bins 列表和直方图每个 bin 中的计数给驱动程序。
·返回所有的数据点给驱动程序，并且允许用绘图库的方法帮你完成这项工作。
·对数据进行采样，然后将它们返回给驱动程序进行绘图。
如果数据集中的行数按十亿级计算，那么第二个方法可能无法实现。因此你需要先对数据进行聚合：
绘制直方图，你可以简单地调用 matplotlib，如以下代码所示：
生成以下图表：


用类似的方式，通过 Bokeh 创建直方图：
因为 Bokeh 在背景中使用 D3.js，所得到的图表是动态的：
如果你的数据足够小，能够适合驱动程序（虽然我们认为使用上一个方法通常会更快），你可以对这些数据使用.hist（……）方法（来自 matplotlib）或者.Histogram（……）方法（来自 Bokeh）：
Matplotlib生成如下图表：


Bokeh生成如下图表：


.3.2 特征之间的交互
散点图（Scatter charts）让我们能够一次可视化多达三个变量之间的交互（尽管我们只在这一节中展示 2D 交互）。除非你正在处理一些时态数据，并且希望随着时间的推移观察变化，否则很少提到 3D 可视化。即便如此，我们也会把时间数据离散化，并且呈现出一系列的 2D 图表，因为解释 3D 图表更复杂一些，并且会令人困惑（多数情况下）。
因为 PySpark 不提供在服务器端的任何可视化模块，并且试图同时绘制数十亿的观测数据是非常不切实际的，所以在这一节中，我们将只对 0.02％的数据集进行采样（大约 2000 个观测数据）。除非你选择分层抽样，不然你应该在预定义的抽样率中创建至少 3 到 5 个样本，这样你就可以检查样本是否有所代表你的数据集——也就是，你的样本之间的差异不大。
在这个例子中，我们将把欺诈数据集作为一个阶层抽取 0.02％样本：
要在一行中放置多个 2D 图表，可以使用以下代码：
这段代码产生以下图表：
正如你所见，有大量的欺诈交易余额为 0，却有许多交易——也就是说，一张新卡但是有大量的交易。不过除了一些在 1000 美金间隔中出现的带状，没有特征的模式也可以显示。
