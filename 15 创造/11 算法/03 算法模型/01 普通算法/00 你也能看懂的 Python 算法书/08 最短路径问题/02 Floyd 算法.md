---
title: 02 Floyd 算法
toc: true
date: 2019-07-01
---
Floyd算法和迪可斯特朗算法一样，可用于解决加权图的最短路径问题。Floyd算法是罗伯特·弗洛伊德发明的。弗洛伊德是图灵奖得主，但他并没有受过正规的计算机教育，是自学成才的。
小朗朗还是有同样的问题：他想坐公交车从 A 站到 F 站，但他看着图 9.7所示的公交车线路图头疼，不知道怎样坐车距离最短。上一节讲述了怎么用迪可斯特朗算法得出从 A 站到 F 站的最短路线，下面让我们用 Floyd 算法解决这个问题。注意：迪可斯特朗算法要求权重不为负数，Floyd算法则没有这项要求。
图 9.7 公交车线路图
9.2.1 算法核心：两个矩阵
Floyd算法比迪可斯特朗算法更加简单易懂。需要创建两个矩阵：距离 D 矩阵和路线 P 矩阵。D矩阵[i][j]中的值代表从 i 节点到 j 节点的最短距离。P矩阵[i][j]中的值代表从 i 节点到 j 节点的最短路径中经过的第一个节点。看表 9.2和表 9.3，这是初始化时的 D 矩阵和 P 矩阵。
表 9.2 初始化时的 D 矩阵
D矩阵记录着加权图中边的权重（距离），如果两个节点没有边相连，在 D 矩阵中用 MAX 记录。注意，你会发现 D 矩阵是关于对角线对称的，因为距离[i][j]等于距离[j][i]。
表 9.3 初始化时的 P 矩阵
P矩阵记录从 i 节点到 j 节点的最短路线中经过的第一个点。比如，从 1 节点到 4 节点用 P[1][4]表示。开始的时候，从 i 到 j 的路线是直达的，所以经过的第一个节点就是 j 节点。
D矩阵需作为参数输入，P矩阵则根据节点数量自动生成。以下代码生成 P 矩阵：

9.2.2 算法核心：通过中介点缩短距离
依次令图中的节点为 k 节点，并使 k 节点作为中介点，如果 D[i][k]+D[k][j]<D[i][j]，也就是说，如果由中介点到达 j 点的距离比直接从 i 到 j 的距离短的话，就更新 D 矩阵和 P 矩阵：D[i][j]=D[i][k]+D[k][j]、P[i][j]=P[i][k]，缩短 D 矩阵的最短距离值，并更改 P 矩阵的最短距离路线。
现在来看一下核心代码。solveFloyd方法有以下参数：
dist，距离矩阵。传入的矩阵记录是节点之间边的距离，如果两个节点间没有边，则记录为 sys.maxsize。
start，起始节点。
end，终止节点。
9.2.3 通过示例理解算法
下面把前面所讲的解题思路用示例过一遍，以便更好地理解 Floyd 算法。如图 9.8所示，依次使节点 0～5为中介点 k。首先，从 0 节点开始。
图 9.8 中介点 k=节点 0
以 0 节点为中介点，从 1 节点到 2 节点的距离由 MAX 缩短为 25，因此，更新 D 矩阵的[1][2]和[2][1]值为 25，如表 9.4所示。
表 9.4 0节点为中介点，更新 D 矩阵
另外，更新 P 矩阵，如表 9.5所示。从 1 节点到 2 节点的最短路线不再是 1—2，而是 1—0—2，因此 P[1][2]等于 0。同样，从 2 节点到 1 节点的最短路线不再是 2—1，而是 2—0—1。因此 P[2][1]等于 0。注意，P[i][j]不一定等于 P[j][i]，两条路线经过的第一个节点有可能不相同。
表 9.5 0节点为中介点，更新 P 矩阵


接下来以 1 节点为中介点，如图 9.9所示。0节点到 3 节点的距离从 MAX 缩短为 15,0节点到 4 节点的距离从 30 缩短为 24,3节点到 4 节点的距离从 MAX 缩短为 19。
图 9.9 中介点 k=节点 1
如表 9.6所示，更新 D 矩阵，D[0][3]和 D[3][0]从 MAX 变为 15,D[0][4]和 D[4][0]从 30 变为 24,D[3][4]和 D[4][3]从 MAX 变为 19。
表 9.6 1节点为中介点，更新 D 矩阵
续表
如表 9.7所示，更新 P 矩阵。从 0 节点到 3 节点的最短路线从 0—3变为 0—1—3，所以 P[0][3]等于 1。从 0 节点到 4 节点的最短路线从 0—4变为 0—1—4，所以 P[0][4]等于 1。同理，P[3][0]、P[4][0]、P[3][4]和 P[4][3]也等于 1。
表 9.7 1节点为中介点，更新 P 矩阵
以 2 节点为中介点不改变任何路线，直接以 3 节点为中介点，如图 9.10所示。从 0 节点到 5 节点的距离由 MAX 变为 25，从 1 节点到 2 节点的距离由 25 变为 17，从 1 节点到 5 节点的距离由 MAX 变为 15，从 2 节点到 5 节点的距离由 MAX 变为 22。


如表 9.8所示，更新 D 矩阵。D[0][5]和 D[5][0]等于 25,D[1][2]和 D[2][1]等于 17,D[1][5]和 D[5][1]等于 15,D[2][5]和 D[5][2]等于 22。
表 9.8 3节点为中介点，更新 D 矩阵
如表 9.9所示，更新 P 矩阵。从 0 到 5 的路线从 0—5变为 0—1—3—5，因此 P[0][5]等于 1。从 5 到 1 的路线从 5—1变为 5—3—1—0，因此 P[5][0]等于 1。从 1 到 2 的路线从 1—2变为 1—3—2，因此 P[1][2]等于 3。同理，P[2][1]、P[1][5]、P[5][1]、P[2][5]、P[5][2]等于 3。
表 9.9 3节点为中介点，更新 P 矩阵
以 4 节点和 5 节点为中介点不改变任何路线，略过它们。如图 9.11所示，来看一下最初的 D 矩阵和最后所有值都是最短距离的 D 矩阵的对比。
图 9.11 D矩阵对比图
来看一下 P 矩阵的对比图，如图 9.12所示。


图 9.12 P矩阵对比图
如果想知道从 0 节点到 5 节点的最短距离，只需要查看 D[0][5]就可得知，这里，D[0][5]等于 25。如果想得出 0 节点到 5 节点的最短路线，只要查看 P 矩阵的 P[0][5]便可得知路线的第一节点是 1。接着，查看 P[1][5]便可得知路线的第二个节点为 3，第三个节点 P[3][5]为 5，也就是终点。因此，得出的最短路线为 0—1—3—5。
9.2.4 完整代码
代码 9.2所示的是 Floyd 算法的完整代码。
代码 9.2 利用 Floyd 算法解决图的最短路线问题
让我们试一试代码能不能解决一开始的问题：
下面是输出结果：


[0,1,3,5]
