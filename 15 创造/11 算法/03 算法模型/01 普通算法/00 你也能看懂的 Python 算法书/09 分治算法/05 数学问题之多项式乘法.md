---
title: 05 数学问题之多项式乘法
toc: true
date: 2019-07-01
---
10.5 数学问题之多项式乘法
多项式乘法是一项基本的数学操作，在数学课上我们都学过怎样手动地把两个括号中的多项式展开。可以让计算机模拟人类，用同样的方式进行计算，但是这一节利用快速傅里叶变换（简称 FFT）创建一个更快捷的方法。FFT采用分治思想降低时间复杂度。
问题为：给予两个多项式 A（x）与 B（x），得出 C（x）=A（x）B（x）。举例，A（x）=3+2x+3x2+4x3,B（x）=2+x2,C（x）=6+4x+9x2+10x3+3x4+4x5。输入与输出为多项式的系数。
输入：[[3,2,3,4],[2,0,1]]
输出：[6,4,9,10,3,5]
10.5.1 问题求解
解决问题之前需要补充一些必要的数学知识。一般情况下，我们都用系数表示多项式，比如[6,4,9,10,3,4]代表 6+4x+9x2+10x3+3x4+4x5。但是，除了用系数表示，多项式还有一种表达方式叫作点值表示。
如果多项式的度数为 n，也就是说，多项式包含 xn 项，则多项式可被 n+1对点值表示，前提条件为点不重复。举例如下。
多项式：A（x）=3+2x+3x2+4x3
取 4 个点：x=（0,1,2,3）
点值对：（0,3）,（1,12）,（2,51）,（3,144）
以上 4 点足以表示多项式 A（x），没有任何其他多项式拥有这 4 个点。
当两个多项式相乘时，只需相乘它们的点值对就可以得到结果多项式的点值表示。举例如下。
多项式：A（x）=3+2x+3x2+4x3,B（x）=2+x2
取 6 个点：x=（−2,−1,0,1,2,3）
点值对：A（x）:（-2,-21）,（-1,0）,（0,3）,（1,12）,（2,51）,（3,144）
B（x）:（-2,6）,（-1,3）,（0,2）,（1,3）,（2,6）,（3,11）
点值乘积：C（x）:（-2,-126）,（-1,0）,（0,6）,（1,36）,（2,306）,（3,1584）
需取 6 点，因为多项式 C（x）的度数为 2+3=5。
知道了如何将系数表示转换为点值表示、如何做多项式点值表示的乘法，就可以开始学习 FFT 算法。FFT算法可以做以下工作。
设结果多项式 C（x）的度数为 n。
找到单位的 n+1次根，总共有 n+1个。
通过分治快速计算 A（x）与 B（x）在这些单位根的值。
将 A（x）与 B（x）的点值相乘，得到 C（x）的点值表示。
将 C（x）的点值表示转换为系数表示。
FFT的要点在于选值。如果只是随便选 n+1个点，那就需要逐个计算这些点对应的值。但是可以利用单位根的特性，从而采取分治算法。让我们通过一个例子理解 FFT 算法以及单位根的特殊性。设
A（x）的系数表示为 A=[a0,a1,a2,a3,a4,a5,a6,a7]。
将 A 分成两部分，一部分为偶数系数，另一部分为奇数系数：


以上两个系数表示代表的多项式为
那么，A（x）可表示为
也就是说，只需计算 A（x）即可得到 A（-x），毕竟两者唯一的不同在于加减法。取点时应该有效利用这个条件，令前半部分的点为后半部分的点的负数。这样的话，计算量直接减半。
比如，如果取 8 个点时，应取[-4,-3,-2,-1,1,2,3,4]而不是[1,2,3,4,5,6,7,8]。这样，只需计算 A（-4）、A（-3）、A（-2）、A（-1），即可得到对应的 A（4）、A（3）、A（2）、A（1）。
但是记住，并不只分治一次，因为 A_even和 A_odd也将递归分解。因此，[-4,-3,-2,-1,1,2,3,4]只在第一次递归时有利。第二次递归时，传入 A_even的点为[1,4,9,16]，而不是理想中的[-1,-4,1,4]，因此第一次递归后没有再减少计算量。
只有选单位根为点才能达到目的。因为单位根的特性，每一次递归都能确保前半部分的点为后半部分的点的负数。举例如下。
单位的 8 次根为：。
点的平方：1,i,-1,-i
再次平方：1,-1
最后平方：1
来看一个实例：
在上一步的计算中，把储存在列表中，以便直接计算值：
又因为
所以，在第一步中，无须直接计算的后半部分，而是在分治时采用同样的方法，将 A_even_even（14）、A_even_even（ω4）、A_odd_odd（14）,A_odd_odd（ω4）的值储存在列表中，方便计算后半部分。
到现在为止，介绍了如何把系数表示有效地转换为点值表示，下一步为把 C（x）的点值表示转换为系数表示。
这一步同样用 FFT 方法。之前用 n 个系数值求 n 个点值，现在反过来用 n 个点值求 n 个系数值。如图 10.28与图 10.29所示，除了单位根变为自己的倒数，其余保持不变。


10.5.2 最终代码
输入：
solver（[3,2,3,4],[2,0,1]）
输出：
[6,4,9,10,3,4]
FFT算法要求多项式的系数表示长度为 2 的幂次方，因此 solver 方法用 0 扩展长度。
