---
title: 51 AB 测试
toc: true
date: 2019-03-27
---
# 可以补充进来的

- 感觉还想再补充下。关于 A/B 测试的。


# A/B 测试

在互联网公司中，A/B 测试是验证新模块、新功能、新产品是否有效，新算法、新模型的效果是否有提升，新设计是否受到用户欢迎，新更改是否影响用户体验的主要测试方法。<span style="color:red;">是的。之前虽然没有使用过，但是听说过，而且，当新的算法开发出来的时候，总是要有评价指标来与就的算法进行对比。</span>


在机器学习领域中，A/B 测试是验证模型最终效果的主要手段。<span style="color:red;">嗯，是验证模型最终效果的主要手段。</span>


A/B测试，实验组，对照组


## 在对模型进行过充分的离线评估之后，为什么还要进行在线 A/B 测试？

<span style="color:red;">是的，我也想知道。</span>

需要进行在线 A/B测试的原因如下。


- 离线评估无法完全消除模型过拟合的影响，因此，得出的离线评估结果无法完全替代线上评估结果。<span style="color:red;">离线评估无法完全消除模型过拟合的影响是什么意思？</span>
- 离线评估无法完全还原线上的工程环境。一般来讲，离线评估往往不会考虑线上环境的延迟、数据丢失、标签数据缺失等情况。因此，离线评估的结果是理想工程环境下的结果。<span style="color:red;">嗯，是的。</span>
- 线上系统的某些商业指标在离线评估中无法计算。离线评估一般是针对模型本身进行评估，而与模型相关的其他指标，特别是商业指标，往往无法直接获得。比如，上线了新的推荐算法，离线评估往往关注的是 ROC 曲线、P-R 曲线等的改进，而线上评估可以全面了解该推荐算法带来的用户点击率、留存时长、PV访问量等的变化。这些都要由 A/B测试来进行全面的评估。<span style="color:red;">是的，这个的确，一些相关的指标都要进行评估。</span>


## 如何进行线上 A/B测试？

进行 A/B测试的主要手段是进行用户分桶，即将用户分成实验组和对照组，对实验组的用户施以新模型，对对照组的用户施以旧模型。<span style="color:red;">嗯，以前好像看到 fb 的一个很大的更新就是这样先更新一部分的用户。然后进行对照。</span>

在分桶的过程中，要注意样本的独立性和采样方式的无偏性，确保同一个用户每次只能分到同一个桶中，在分桶过程中所选取的 user_id 需要是一个随机数，这样才能保证桶中的样本是无偏的。<span style="color:red;">嗯，随机分桶。</span>


## 如何划分实验组和对照组

H公司的算法工程师们最近针对系统中的“美国用户”研发了一套全新的视频推荐模型 A，而目前正在使用的针对全体用户的推荐模型是 B。

在正式上线之前，工程师们希望通过 A/B测试来验证新推荐模型的效果。下面有三种实验组和对照组的划分方法，请指出哪种划分方法是正确的？

1. 根据 user_id（user_id完全随机生成）个位数的奇偶性将用户划分为实验组和对照组，对实验组施以推荐模型 A，对照组施以推荐模型 B；
2. 将 user_id个位数为奇数且为美国用户的作为实验组，其余用户为对照组；
3. 将 user_id个位数为奇数且为美国用户的作为实验组，user_id个位数为偶数的用户作为对照组。

<span style="color:red;">感觉上面三种都不正确吧？？</span><span style="color:blue;">嗯，是的。</span>


上述 3 种 A/B测试的划分方法都不正确。

我们用包含关系图来说明三种划分方法，如图 2.4所示。

- 方法 1（见图 2.4（a））没有区分是否为美国用户，实验组和对照组的实验结果均有稀释；
- 方法 2（见图 2.4（b））的实验组选取无误，并将其余所有用户划分为对照组，导致对照组的结果被稀释；<span style="color:red;">什么叫结果被稀释？</span>
- 方法 3（见图 2.4（c））的对照组存在偏差。

![](http://images.iterate.site/blog/image/20190327/8jv30B8MHOms.png?imageslim){ width=55% }
![](http://images.iterate.site/blog/image/20190327/QNJXCQSvOfQ9.png?imageslim){ width=55% }

正确的做法是将所有美国用户根据 user_id 个位数划分为试验组合对照组（见图 2.4（d）），分别施以模型 A 和 B，才能够验证模型 A 的效果。<span style="color:red;">是的。</span>



# 相关

- 《百面机器学习》
