---
title: 1.03 传统的图像分割
toc: true
date: 2019-09-15
---
# 没有深度学习的那些年


图像处理算法都是从传统方法开始的，我们就简单理解为非深度学习的方法吧。



![mark](http://images.iterate.site/blog/image/20190906/yIg2SKuDhAsG.png?imageslim)


图像分割是什么？如果下学术定义，就是把图像分割成想要的语义上相同的若干子区域，看上面的自动驾驶的分割任务，路是路，车是车，树是树。

这些子区域，组成图像的完备子集，相互之间不重叠。图像分割可以被看作是一个逐像素的图像分类问题

没有深度学习的那些年，也发展出了非常多的图像分割技术，下面挑重点长话短说。


## 边缘与阈值法

简单的边缘检测也曾被用于图像分割，但是因为要做复杂后处理以及后面和其他方法有重叠，这里就不再说了，而是从阈值法开始说。

阈值法的基本思想是基于图像的灰度特征来计算一个或多个灰度阈值，并将图像中每个像素的灰度值与阈值相比较。

其中，最广泛使用也最具有代表性质就是 OTSU【1】方法，它是用于灰度图像分割的方法，核心思想就是使类间方差最大。

这样的方法，非常简单，要求被分割的物体颜色纹理比较紧凑，类内方差小，只适合一些文本图像的处理，比如车牌，比如指纹。

![mark](http://images.iterate.site/blog/image/20190906/xCPXOqoYP5vU.png?imageslim)




## 区域增长，分裂

阈值法的一个硬伤是太粗暴简单，哪怕是自适应的局部阈值法，一样难逃无法分割类内方差较大的目标的宿命。它完全没有利用好像素的空间信息，导致分割结果极其容易受噪声干扰，经常出现断裂的边缘，需要后处理。

所以，区域生长法出现了，它通过一些种子点，再加上相似性准则来不断扩充区域直到达到类别的边界，这时候分割结果是连续的了。

区域分裂则是反过程，不再详述。区域增长法的佼佼者，就是分水岭算法【2】。

分水岭算法是一种基于拓扑理论的数学形态学的分割方法，将图像中每一点像素的灰度值表示该点的海拔高度，每一个局部极小值称为集水盆，而集水盆的边界则是分水岭。分水岭算法有很多种实现算法，常用浸水模拟法。

分水岭算法对于弱边缘有不错的响应，因此常被用于材料图像的分割，以及产生超像素用于提高其他方法的分割效率。还不错。

![mark](http://images.iterate.site/blog/image/20190906/J8MsBnRl4gAj.png?imageslim)


说到这里，超像素也是很重要的一种方法，某种程度上也能被归为图像分割的方法。SLIC，Meanshift等都是非常经典的方法，去文【3】中做更详细解读吧。笔者在很多的实际项目中都使用过，配合下面要讲的方法一起使用，绝配。

![mark](http://images.iterate.site/blog/image/20190906/kQ8C7vtfAvOO.png?imageslim)


## 图割

以 graphcut【4】为代表的图割方法，是传统图像分割里面鲁棒性最好的方法，它是一种概率无向图模型(Probabilistic undirected graphical model)，又被称 Markov random field马尔可夫随机场。

Graphcut的基本思路，就是建立一张图，看下面这张图，其中以图像像素或者超像素作为图像顶点，然后优化的目标就是要找到一个切割，使得各个子图不相连从而实现分割，前提是移除边的和权重最小。

后来图割方法从 MRF 发展到 CRF，也就是条件随机场。它通常包含两个优化目标，一个是区域的相似度，被称为区域能量项，即 piecewise 能量。一个是被切断边的相似度，被称为边缘能量项，即 pairwise 能量。它追求区域能量项的最大化以及边缘能量的最小化，也就是区域内部越相似越好，区域间相似度越低越好。

图割方法很通用，对于纹理比较复杂的图像分割效果也不错。缺点是时间复杂度和空间复杂度较高，所以通常使用超像素进行加速计算，上面的分水岭算法就可以拿来用用。



![mark](http://images.iterate.site/blog/image/20190906/wJtsqAvHqmFe.png?imageslim)


graphcut的迭代版本，也就是 grabcut【5】更好用，它的基本思路是；使用混合高斯模型(Gaussian Mixture Model，GMM)替代了 graphcut 基于灰度的模型，初始的混合高斯模型的构建，通过用户交互来指定，只需要指定确定性的背景像素区域即可，通常是画一个框。

多年以后再看下面这张图，效果依然是惊艳的，边缘很不错。不像上面的几个方法，图割方法仍然被广泛使用，deeplab系列的前几篇文章就用到了全连接的 crf，它与 mrf 的区别可以参考这篇文章【Discriminative fields for modeling spatial dependencies in natural images】。

![mark](http://images.iterate.site/blog/image/20190906/Mxr62IwFiFvx.png?imageslim)


图割方法很好用，是每个想做图像分割的同学必须掌握的。



## 轮廓模型

轮廓模型大部分人可能不知道，它的基本思想是使用连续曲线来表达目标轮廓，并定义一个能量泛函，其自变量为曲线，将分割过程转变为求解能量泛函的最小值的过程。数值实现可通过求解函数对应的欧拉(Euler-Lagrange)方程来实现。包括以 snake 模型为代表的参数活动轮廓模型和以水平集方法为代表的几何活动轮廓模型。


当能量达到最小时的，曲线位置就处于正确的目标轮廓。

该类分割方法具有几个显著的特点：(1)由于能量泛函是在连续状态下实现，所以最终得到的图像轮廓可以达到较高的精度；(2)通过约束目标轮廓为光滑，同时融入其它关于目标形状的先验信息，算法可以具有较强的鲁棒性；(3)使用光滑的闭合曲线表示物体的轮廓，可获取完整的轮廓，从而避免传统图像分割方法中的预/后处理过程。

不过，缺点也很明显，比较敏感，容易陷入局部极值。

下面是采用水平集方法分割出的肿瘤，就是白色那一块。


![mark](http://images.iterate.site/blog/image/20190906/9lEeMUougXfm.png?imageslim)


传统方法远不止于此，但是我们应该接着说深度学习的方法了。


# 相关

- [【技术综述】闲聊图像分割这件事儿](https://tianchi.aliyun.com/forum/postDetail?postId=63791)
