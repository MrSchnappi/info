---
title: 1.12 自然场景 OCR 的挑战及解决
toc: true
date: 2019-09-15
---
# 自然场景 OCR 的挑战

## 自然场景 OCR 的挑战

随着移动设备的普及，对拍摄图像中的文字提取和识别成为主流需求，同时对场景中文字的识别需求越来越突出。因此，相比于印刷体场景，拍照文字的识别将面临以下三方面挑战：

- 成像复杂。噪声、模糊、光线变化、形变。
- 文字复杂。字体、字号、色彩、磨损、笔画宽度任意、方向任意。
- 场景复杂。版面缺失、背景干扰。

## 传统的 OCR 方案的不足

对于上述挑战，传统的 OCR 解决方案存在着以下不足：

- 通过版面分析（连通域分析）和行切分（投影分析）来生成文本行，要求版面结构有较强的规则性且前背景可分性强（例如黑白文档图像、车牌），无法处理前背景复杂的随意文字（例如场景文字、菜单、广告文字等）。另外，二值化操作本身对图像成像条件和背景要求比较苛刻。
- 通过人工设计边缘方向特征（例如方向梯度直方图）来训练字符识别模型，在字体变化、模糊或背景干扰时，此类单一的特征的泛化能力迅速下降。
- 过度依赖于字符切分的结果，在字符扭曲、粘连、噪声干扰的情况下，切分的错误传播尤其突出。
- 尽管图像预处理模块可有效改善输入图像的质量，但多个独立的校正模块的串联必然带来误差传递。另外由于各模块优化目标独立，它们无法融合到统一的框架中进行。




## 现在技术在三个方面的改进

为了解决上述问题，现有技术在以下三方面进行了改进。

**1. 文字行提取**

传统 OCR（如图 3 所示）采取自上而下的切分式，但它只适用于版面规则背景简单的情况。该领域还有另外两类思路。

<center>

![mark](http://images.iterate.site/blog/image/20190915/JQN2KVrt8uYX.png?imageslim)

</center>

> 基于自底向上的文字检测

- 自底向上的生成式方法。该类方法通过连通域分析或最大稳定极值区域（MSER）等方法提取候选区域，然后通过文字/非文字的分类器进行区域筛选，对筛选后的区域进行合并生成文字行，再进行文字行级别的过滤，如图 3 所示。该类方法的不足是，一方面流程冗长导致的超参数过多，另一方面无法利用全局信息。
- 基于滑动窗口的方法。该类方法利用通用目标检测的思路来提取文字行信息，利用训练得到的文字行/词语/字符级别的分类器来进行全图搜索。原始的基于滑动窗口方法通过训练文字/背景二分类检测器，直接对输入图像进行多尺度的窗口扫描。检测器可以是传统机器学习模型（Adaboost、Random Ferns），也可以是深度卷积神经网络。

为了提升效率，DeepText、TextBoxes 等方法先提取候选区域再进行区域回归和分类，同时该类方法可进行端到端训练，但对多角度和极端宽高比的文字区域召回低。

**2. 传统单字识别引擎→基于深度学习的单字识别引擎**

由于单字识别引擎的训练是一个典型的图像分类问题，而卷积神经网络在描述图像的高层语义方面优势明显，所以主流方法是基于卷积神经网络的图像分类模型。实践中的关键点在于如何设计网络结构和合成训练数据。

对于网络结构，我们可以借鉴手写识别领域相关网络结构，也可采用 OCR 领域取得出色效果的 Maxout 网络结构，如下图所示。

<center>

![mark](http://images.iterate.site/blog/image/20190915/nfxHTF8NB0wT.png?imageslim)

</center>

> 基于 Maxout 卷积神经网络结构的单字识别模型

对于数据合成，需考虑字体、形变、模糊、噪声、背景变化等因素。



下表给出了卷积神经网络的特征学习和传统特征的性能比较，可以看出**通过卷积神经网络学习得到的特征鉴别能力更强**。


<center>

![mark](http://images.iterate.site/blog/image/20190915/QYwJ8dg25leo.png?imageslim)

</center>

> 单字符识别引擎性能比较


**3. 文字行识别流程**

传统 OCR 将文字行识别划分为字符切分和单字符识别两个独立的步骤，尽管通过训练基于卷积神经网络的单字符识别引擎可以有效提升字符识别率，但切分对于字符粘连、模糊和形变的情况的容错性较差，而且切分错误对于识别是不可修复的。因此在该框架下，文本行识别的准确率主要受限于字符切分。假设已训练单字符识别引擎的准确率 $p=99%$，字符切分准确率为 $q= 95%$，则对于一段长度为 L 的文字行，其识别的平均准确率为 $P= (pq)$ 的 $L$ 次方，其中 $L=10$ 时，$P=54.1%$。

由于独立优化字符切分提升空间有限，因此有相关方法试图联合优化切分和识别两个任务。现有技术主要可分为基于切分的方法（Segmentation-Based）和不依赖切分的方法（Segmentation- Free）两类方法。

**基于切分的方法**

该类方法还是保留主动切分的步骤，但引入了动态合并机制，通过识别置信度等信息来指导切分，如下图所示。

<center>

![mark](http://images.iterate.site/blog/image/20190915/xC5r2e9KmUh3.png?imageslim)

</center>

> 基于 CNN 的动态切分与识别流程


过切分模块将文字行在垂直于基线方向上分割成碎片，使得其中每个碎片至多包含一个字符。通常来说，过切分模块会将字符分割为多个连续笔划。过切分可以采用基于规则或机器学习的方法。规则方法主要是直接在图像二值化的结果上进行连通域分析和投影分析来确定候补切点位置，通过调整参数可以控制粒度来使得字符尽可能被切碎。基于规则的方法实现简单，但在成像/背景复杂的条件下其效果不好。机器学习方法通过离线训练鉴别切点的二类分类器，然后基于该分类器在文字行图像上进行滑窗检测。

动态合并模块将相邻的笔划根据识别结果组合成可能的字符区域，最优组合方式即对应最佳切分路径和识别结果。直观来看，寻找最优组合方式可转换为路径搜索问题，对应有深度优先和广度优先两种搜索策略。深度优先策略在每一步选择扩展当前最优的状态，因此全局来看它是次优策略，不适合过长的文字行。广度优先策略在每一步会对当前多个状态同时进行扩展，比如在语音识别领域广泛应用的 Viterbi 解码和 Beam Search。但考虑到性能，Beam Search通常会引入剪枝操作来控制路径长度，剪枝策略包含限制扩展的状态数（比如，每一步只扩展 TopN 的状态）和加入状态约束（比如，合并后字符形状）等。

由于动态合并会产生多个候选路径，所以需要设计合适的评价函数来进行路径选择。评价函数的设计主要从路径结构损失和路径识别打分两方面出发。路径结构损失主要从字符形状特征方面衡量切分路径的合理性，路径识别打分则对应于特定切分路径下的单字平均识别置信度和语言模型分。

该方案试图将字符切分和单字符识别融合在同一个框架下解决，但由于过分割是独立的步骤，因此没有从本质上实现端到端学习。

**不依赖切分的方法**

该类方法完全跨越了字符切分，通过滑动窗口或序列建模直接对文字行进行识别。

滑窗识别借鉴了滑动窗口检测的思路，基于离线训练的单字识别引擎，对文字行图像从左到右进行多尺度扫描，以特定窗口为中心进行识别。在路径决策上可采用贪心策略或非极大值抑制（NMS）策略来得到最终的识别路径。图 6 给出了滑窗识别的示意流程。可见滑窗识别存在两个问题：滑动步长的粒度过细则计算代价大，过粗则上下文信息易丢失；无论采用何种路径决策方案，它们对单字识别的置信度依赖较高。

<center>

![mark](http://images.iterate.site/blog/image/20190915/r4qQ1SNNCYyV.png?imageslim)

</center>

> 基于滑动窗口的文字检测


序列学习起源于手写识别、语音识别领域，因为这类问题的共同特点是需要对时序数据进行建模。尽管文字行图像是二维的，但如果把从左到右的扫描动作类比为时序，文字行识别从本质上也可归为这类问题。通过端到端的学习，摒弃矫正/切分/字符识别等中间步骤，以此提升序列学习的效果，这已经成为当前研究的热点。

现在的文字检测和文字行识别采用如下图所示的深度学习框架。

<center>

![mark](http://images.iterate.site/blog/image/20190915/nNAdoKd45aY6.png?imageslim)

</center>

> 基于深度学习的 OCR 解决方案



后面将分别介绍文字检测和文字行识别这两部分的具体方案。




# 相关

- [深度学习在 OCR 中的应用](https://tech.meituan.com/2018/06/29/deep-learning-ocr.html)
